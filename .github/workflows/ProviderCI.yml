name: Provider-API

on:
  workflow_dispatch:
  push:

jobs:

  test-local:
    runs-on: ubuntu-latest
    env:
      application_name: ${{ needs.setup.outputs.application_name }}
    steps:
      - uses: actions/checkout@v3
      - name: foo
        run: |
          sudo apt update -y 
          sudo apt install -y default-jdk
          wget https://dlcdn.apache.org/kafka/3.4.0/kafka_2.13-3.4.0.tgz
          tar xzf kafka_2.13-3.4.0.tgz 
          sudo mv kafka_2.13-3.4.0 /usr/local/kafka
          /usr/local/kafka/bin/zookeeper-server-start.sh /usr/local/kafka/config/zookeeper.properties &
          sleep 25
      - name: Test
        run: chmod ugo+rwx ReadyAPI_Tests && ./startServerAndTest.sh
        env:
          PROJECT_FOLDER: ReadyAPI_Tests
          PROJECT_FILE: 'kafka_ready_project.xml'
          SLM_API_KEY: ${{ secrets.SLM_API_KEY }}
          SERVER_COMMAND: '/usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties'
          CREATE_TOPIC_COMMAND: '/usr/local/kafka/bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test'
          ENDPOINT: localhost:9092
    outputs:
      version: ${{ env.version }}